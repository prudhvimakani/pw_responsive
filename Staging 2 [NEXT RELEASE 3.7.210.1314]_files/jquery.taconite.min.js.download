/*!
 * jQuery Taconite plugin - A port of the Taconite framework by Ryan Asleson and
 *     Nathaniel T. Schutta: http://taconite.sourceforge.net/
 *
 * Examples and documentation at: http://malsup.com/jquery/taconite/
 * Copyright (c) 2007-2011 M. Alsup
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 * Thanks to Kenton Simpson for contributing many good ideas!
 *
 * @version: 3.64  16-JUN-2011
 * @requires jQuery v1.3.2 or later
 */
(function(a){function z(b,c,d){for(var e=0,f="";e<c.attributes.length;e++){var g=c.attributes[e],h=a.trim(g.name),i=a.trim(g.value);if(d)f+=h+'="'+i+'" ';else if(h=="style"){b.style.cssText=i;b.setAttribute(h,i)}else a.attr(b,h,i)}return f}function y(b,c){var d,e=b.tagName.toLowerCase();if(a.browser.msie&&a.browser.version<9){var f=b.getAttribute("type");if(e=="table"||f=="radio"||f=="checkbox"||e=="button"||e=="select"&&b.getAttribute("multiple")){d=document.createElement("<"+e+" "+z(null,b,true)+">")}}if(!d){d=document.createElement(e);z(d,b)}if(a.browser.msie&&e=="td"){var g=b.getAttribute("colspan");if(g)d.colSpan=parseInt(g)}if(a.browser.msie&&!d.canHaveChildren){if(b.childNodes.length>0)d.text=b.text}else{for(var h=0,i=b.childNodes.length;h<i;h++){var j=v(b.childNodes[h],c);if(j)d.appendChild(j)}}if(!a.browser.mozilla){if(e=="select"||e=="option"&&b.getAttribute("selected"))d.taconiteTag=1}return d}function x(b){if(a.browser.msie)b=b.replace(/\n/g,"\r").replace(/\s+/g," ");return document.createTextNode(b)}function w(b,c){var d=document.createElement(c);var e=a(d)[c=="script"?"text":"html"](b);var f=e.children();if(f.size()==1)return f[0];return d}function v(a,b){var c=a.nodeType;if(c==1)return y(a,b);if(c==3)return x(a.nodeValue);if(c==4)return w(a.nodeValue,b);return null}function u(a){for(var b=0,c=[];b<a.length;b++)if(a[b].nodeType==1)c.push(a[b]);return c}function t(){if(a.browser.mozilla)return;a("select:taconiteTag").each(function(){var b=this;a("option:taconiteTag",this).each(function(){this.setAttribute("selected","selected");this.taconiteTag=null;if(b.type=="select-one"){var c=a("option",b).index(this);b.selectedIndex=c}});this.taconiteTag=null})}function s(a,b,c,e){var f="...";if(!e){f="";for(var g=0,h=c[0];g<c.length,h=c[g];g++){g>0&&(f+=",");typeof h=="string"?f+="'"+h+"'":f+=h}}d("invoking command: $('",a,"').",b,"("+f+")")}function r(b){k={};l=false;var c={wrap:1};var e=0;var f,g,h,i,j,n,o,p,q,r,w,x;for(i=0;i<b.length;i++){if(b[i].nodeType!=1)continue;var y=b[i],z=y.tagName;if(z=="eval"){n=y.firstChild?y.firstChild.nodeValue:null;d('invoking "eval" command: ',n);if(n)a.globalEval(n);continue}if(z=="rawData"){p=y.firstChild?y.firstChild.nodeValue:null;q=y.getAttribute("type");d("rawData ("+q+"): ",p);var A=y.getAttribute("namespace")||"none";!k[A]&&(k[A]=[]);k[A].push({data:m(q,p),type:q,name:y.getAttribute("name")||null,raw:p});!l&&(l=true);continue}r=y.getAttribute("select");w=a(r);if(!w[0]){d("No matching targets for selector: ",r);continue}x=y.getAttribute("cdataWrap")||a.taconite.defaults.cdataWrap;f=[];if(y.childNodes.length>0){e=1;for(j=0,o=[];j<y.childNodes.length;j++)o[j]=v(y.childNodes[j],x);f.push(c[z]?u(o):o)}g=y.getAttribute("name");h=y.getAttribute("value");if(g!==null)f.push(g);if(h!==null)f.push(h);for(var j=1;true;j++){h=y.getAttribute("arg"+j);if(h===null)break;if(h.length){var g=Number(h);if(h==g)h=g}f.push(h)}a.taconite.debug&&s(r,z,f,o);w[z].apply(w,f)}e&&t()}function q(b){try{var c=(new Date).getTime();r(b.childNodes);a.taconite.lastTime=(new Date).getTime()-c;d("time to process response: "+a.taconite.lastTime+"ms")}catch(e){if(window.console&&window.console.error)window.console.error("[taconite] ERROR processing document: "+e);throw e}return true}function p(b){var c;d("attempting string to document conversion");try{if(window.DOMParser){var e=new DOMParser;c=e.parseFromString(b,"text/xml")}else{c=a("<xml>")[0];c.async="false";c.loadXML(b)}}catch(f){if(window.console&&window.console.error)window.console.error("[taconite] ERROR parsing XML string for conversion: "+f);throw f}var g=c&&c.documentElement&&c.documentElement.tagName!="parsererror";d("conversion ",g?"successful!":"FAILED");return c}function o(b){var c=true,e;try{if(typeof b=="string")b=p(b);if(!(b&&b.documentElement)){d("$.taconite invoked without valid document; nothing to process");return false}var f=b.documentElement.tagName;d("XML document root: ",f);var g=a("taconite",b)[0];if(!g){d("document does not contain <taconite> element; nothing to process");return false}a.event.trigger("taconite-begin-notify",[g]);c=q(g)}catch(h){c=e=h}l&&a.event.trigger("taconite-rawdata-notify",[k]);a.event.trigger("taconite-complete-notify",[b,!!c,c===true?null:c]);if(e)throw e}function n(a){return e(a)}function m(b,c){var d=c,e=j[b];if(a.isFunction(e))return e(c);else throw'No parser registered for rawData of type "'+b+'"'}function h(b,c,e){var f=b.getResponseHeader("content-type");if(a.taconite.debug){d("[AJAX response] content-type: ",f,";  status: ",b.status," ",b.statusText,";  has responseXML: ",b.responseXML!=null);d("type arg: "+c)}var h=g(b,c,e);if(h&&h.documentElement&&h.documentElement.nodeName!="parsererror"){a.taconite(h)}else if(typeof h=="string"){if(/taconite/.test(h))a.taconite(h)}else{d("jQuery core httpData returned: "+h);d('httpData: response is not XML (or not "valid" XML)')}return h}function g(a,b,c){if(i)return i(a,b,c);return a.responseXML||a.responseText}function f(b,c,d){var f=b.getResponseHeader("content-type")||"",g=c==="xml"||!c&&f.indexOf("xml")>=0,h=g?b.responseXML:b.responseText;if(g&&h.documentElement.nodeName==="parsererror"){a.error&&a.error("parsererror")}if(d&&d.dataFilter){h=d.dataFilter(h,c)}if(typeof h==="string"){if(c==="json"||!c&&f.indexOf("json")>=0){h=e(h)}else if(c==="script"||!c&&f.indexOf("javascript")>=0){a.globalEval(h)}}return h}function d(){if(!a.taconite.debug||!window.console||!window.console.log)return;!(c++)&&d("Plugin Version: "+b);window.console.log("[taconite] "+[].join.call(arguments,""))}var b="3.64";a.taconite=function(a){o(a)};a.taconite.debug=0;a.taconite.autodetect=true;a.taconite.defaults={cdataWrap:"div"};a.fn.replace=a.fn.replace||function(a){this.after(a);this.remove()};a.fn.replaceContent=a.fn.replaceContent||function(a){return this.empty().append(a)};a.expr[":"].taconiteTag=function(a){return a.taconiteTag===1};a.taconite.enableAutoDetection=function(b){a.taconite.autodetect=b;if(i)a.httpData=b?i:h};var c=0;var e=a.parseJSON||function(a){return window["eval"]("("+a+")")};a.ajaxPrefilter&&a.ajaxPrefilter(function(b,c,d){d.success(function(c,d,e){if(a.taconite.autodetect)h(e,b.dataType,b)})});var i=a.httpData;if(a.httpData)a.httpData=h;var j={json:n},k,l;a.taconite.registerParser=function(a,b){j[a]=b}})(jQuery)
